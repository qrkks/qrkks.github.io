<!DOCTYPE html>
<html lang="  zh
">
  <head>
        <script src="https://cdn.tailwindcss.com"></script>
      <link rel="stylesheet" href="/static/css/tailwind.min.css" />
      <link rel="stylesheet" href="/static/css/pygment.css" />
      <link rel="stylesheet" href="/static/css/custom.css" />
      <script defer src="/static/js/script.js"></script>
      <script 
              src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.25.0/tocbot.min.js"></script>
      <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.25.0/tocbot.css">

      <title>
  Python Website Building Learning Journal - 使用 Javascript, tailwind css 建一个动态目录
      </title>
      <meta charset="utf-8" />
      <meta name="generator" content="Pelican" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://qrkks.github.io/feeds/all.atom.xml"
              type="application/atom+xml"
              rel="alternate"
              title="Python Website Building Learning Journal Full Atom Feed" />
        <link href="https://qrkks.github.io/feeds/pelican.atom.xml"
              type="application/atom+xml"
              rel="alternate"
              title="Python Website Building Learning Journal Categories Atom Feed" />

    <meta name="tags" content="pelican" />
    <meta name="tags" content="javascript" />
    <meta name="tags" content="toc" />
    <meta name="tags" content="nav" />
    <meta name="tags" content="tailwind" />
  </head>
  <body class="font-noto-sans-sc ">
    <header class="flex justify-around p-3 text-gray-500 bg-gray-200 toc-exclude">
      <hgroup>
          <h2>
            <a href="https://qrkks.github.io/">Python Website Building Learning Journal</a>
          </h2>
      </hgroup>
      <nav>
        <ul class="flex gap-5 mx-4">
              <li>
                <a href="https://qrkks.github.io/pages/blog-log.html"
>Blog Log</a>
              </li>
              <li>
                <a href="https://qrkks.github.io/category/code-learning.html"
>Code Learning</a>
              </li>
              <li>
                <a href="https://qrkks.github.io/category/pelican.html"
 aria-current="page" >Pelican</a>
              </li>
              <li>
                <a href="https://qrkks.github.io/category/taiwind-css.html"
>Taiwind CSS</a>
              </li>
        </ul>
      </nav>
    </header>
    <div class="flex flex-col lg:flex-row">
        <aside class="order-1 w-full bg-white lg:w-1/5">
        </aside>
        <aside class="relative order-3 w-full bg-gray-50 lg:w-1/5">
          <div id="table-of-contents" class="fixed p-4 text-sm border-gray-200 border-y top-36 ">
            <ul id="toc-list" class="space-y-2 list-none">
                <!-- JavaScript will dynamically fill this list -->
            </ul>
        </div>
        </aside>
      <main class="order-2 w-full max-w-4xl p-10 mx-auto prose toc-content-area lg:w-3/5 js-toc-content">
  <article class="text-gray-700">
    <header>
      <h1>
        <a href="https://qrkks.github.io/drafts/building-dynamic-toc-with-javascript.html"
           rel="bookmark"
           title="Permalink to 使用 Javascript, tailwind css 建一个动态目录">使用 Javascript, tailwind css 建一个动态目录</a>
      </h1>
      
    </header>
    <h2>1 实现思路</h2>
<ol>
<li>使用 tailwind 建一个目录的框架和样式。</li>
<li>设置要生成目录的内容区，可以通过添加类名进行选择和反选。</li>
<li>由 javascript 监听内容区提取标题加入到目录中，并监听滚动高亮正在显示的标题。</li>
<li>监听点击。</li>
</ol>
<h2>2 Javascript 代码</h2>
<div class="highlight"><pre><span></span><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 获取TOC列表的容器</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">tocList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;toc-list&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 定义要选择的标题</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">headingSelector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;h1, h2, h3, h4, h5&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 选择指定容器内的标题元素</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">headings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;.toc-content-area &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">headingSelector</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 函数：更新TOC高亮状态</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">updateTocHighlight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">foundActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">headings</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 排除带有特定类（toc-exclude）的元素</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.toc-exclude&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// 获取标题的位置</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">bounding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// 判断标题是否在视窗内</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bounding</span><span class="p">.</span><span class="nx">top</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">bounding</span><span class="p">.</span><span class="nx">bottom</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;#toc-list a&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">a</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;font-bold&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text-red-500&#39;</span><span class="p">);</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">a</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;font-bold&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text-red-500&#39;</span><span class="p">);</span>
<span class="w">                        </span><span class="nx">foundActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 遍历所有标题元素，为它们创建TOC项</span>
<span class="w">    </span><span class="nx">headings</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.toc-exclude&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">innerText</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 根据标题级别计算左边距</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">marginLeftClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`ml-</span><span class="si">${</span><span class="nx">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">4</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 创建TOC项</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">listItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">listItem</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;a href=&quot;#</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">&quot; class=&quot;text-blue-500 hover:text-blue-700 </span><span class="si">${</span><span class="nx">marginLeftClass</span><span class="si">}</span><span class="sb">&quot;&gt;</span><span class="si">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">innerText</span><span class="si">}</span><span class="sb">&lt;/a&gt;`</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 为TOC项添加点击事件监听器</span>
<span class="w">        </span><span class="nx">listItem</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">scrollIntoView</span><span class="p">({</span><span class="w"> </span><span class="nx">behavior</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;smooth&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">updateTocHighlight</span><span class="p">,</span><span class="w"> </span><span class="mf">200</span><span class="p">);</span><span class="w"> </span><span class="c1">// 延迟更新高亮</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">tocList</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">listItem</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 监听滚动事件以更新TOC高亮</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateTocHighlight</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h2>3 详细解释</h2>
<h3>3.1 <code>getBoundingClientRect()</code></h3>
<p><code>getBoundingClientRect()</code> 是一个 JavaScript DOM 方法，它返回一个 DOM 元素的大小及其相对于视口的位置。当这个方法应用于一个 DOM 节点时（比如一个 HTML 元素），它会提供该元素的 <code>top</code>, <code>bottom</code>, <code>left</code>, <code>right</code>, <code>width</code>, 和 <code>height</code> 等属性。</p>
<p>在我们的动态目录（TOC）的上下文中，<code>getBoundingClientRect()</code> 被用来确定一个标题元素在当前视口中的位置。这是非常重要的，因为它允许脚本知道用户当前查看的是哪部分内容。</p>
<h4>3.1.1 代码示例解释</h4>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">bounding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</code></pre></div>

<p>在这行代码中：</p>
<ul>
<li><code>node</code> 代表一个标题元素（如 <code>h1</code>, <code>h2</code>, <code>h3</code> 等）。</li>
<li><code>getBoundingClientRect()</code> 对该元素调用，返回一个包含该元素位置和尺寸的对象。</li>
<li><code>bounding</code> 变量现在包含了元素的位置信息。</li>
</ul>
<h4>3.1.2 如何使用这些信息</h4>
<ul>
<li><code>bounding.top</code>: 元素顶部相对于视口顶部的距离。如果这个值小于或等于 0，意味着元素的顶部已经滚动到视口顶部或以上。</li>
<li><code>bounding.bottom</code>: 元素底部相对于视口顶部的距离。如果这个值大于视口的高度，意味着元素的底部还没有进入视口。</li>
</ul>
<p>这些信息被用来判断一个标题是否在当前视口内，从而决定是否将对应的 TOC 项设置为“活动”状态，这通常通过改变样式（如高亮）来实现。</p>
<h4>3.1.3 <code>getBoundingClientRect</code> 方法的字面意思</h4>
<p><code>getBoundingClientRect</code> 方法的字面意思可以分为两部分：</p>
<ol>
<li><strong>Bounding</strong>: 在这个上下文中，"bounding" 通常指的是一个边界框（bounding box）或外围矩形（bounding rectangle）。这个边界框是围绕着元素最小的矩形，包含了元素的全部可视部分，包括边框、滚动条等。</li>
<li><strong>ClientRect</strong>: "ClientRect" 指的是客户端区域（client area），在浏览器中通常指的是浏览器视口（viewport）的区域。这个区域不包括浏览器的界面元素（如地址栏、工具栏等），只包括网页内容显示的部分。</li>
<li>"Rect" 在 <code>getBoundingClientRect</code> 方法中是 "rectangle"（矩形）的缩写。在计算机图形学和 Web 开发中，矩形通常用来描述一个元素或区域的形状和大小，它由两个坐标（通常是左上角和右下角）或者一个坐标加上宽度和高度来定义。</li>
</ol>
<p>所以，<code>getBoundingClientRect</code> 方法的名字表示它返回一个元素在客户端区域（即视口）内的边界框信息。这个信息包括元素的位置（相对于视口的左上角）和尺寸（宽度和高度）。</p>
<h4>3.1.4 小结</h4>
<p>实际上就是获取客户端方块的意思，返回的与 <strong>两个“方块”（或矩形）</strong> 相关的信息：</p>
<ol>
<li><strong>元素本身的方块</strong>：这指的是元素的外围边界框。这个矩形框定义了元素的尺寸，包括其宽度（<code>width</code>）和高度（<code>height</code>）。</li>
<li><strong>元素相对于视口的位置</strong>：这些信息表示元素的边界框相对于浏览器视口（屏幕上可见区域）的位置。它包括元素顶部（<code>top</code>）、底部（<code>bottom</code>）、左侧（<code>left</code>）和右侧（<code>right</code>）距离视口顶部和左侧的距离。</li>
</ol>
<p>总结来说，<code>getBoundingClientRect</code> 方法提供了<strong>一个元素在页面上的几何信息，这包括它的大小和它相对于当前视口的位置</strong>。这个方法在处理页面布局和交互时非常有用，特别是在需要确定元素是否在当前可视区域内，以及元素的确切位置时。</p>
<footer class="grid grid-cols-1 gap-4 px-10 py-5 my-10 text-sm text-gray-500 bg-gray-100 rounded not-prose">
  <p>
    Published: <time datetime="2023-12-29T00:00:00+08:00">
    2023-12-29
  </time>
</p>
  <p>
    Last updated: <time datetime="2023-12-29T15:51:31+08:00">
    2023-12-29
  </time>
</p>
  <p class="col-span-2 ">
    Category: <a class="px-3 py-1 text-white duration-300 bg-yellow-400 rounded-full hover:bg-yellow-600"
    href="https://qrkks.github.io/category/pelican.html">Pelican</a>
  </p>
  <p class="col-span-2">
    Tags:
      <a class="px-3 py-1 text-white duration-300 bg-pink-400 rounded-full hover:bg-pink-600"
         href="https://qrkks.github.io/tag/pelican.html">pelican</a>
      <a class="px-3 py-1 text-white duration-300 bg-pink-400 rounded-full hover:bg-pink-600"
         href="https://qrkks.github.io/tag/javascript.html">javascript</a>
      <a class="px-3 py-1 text-white duration-300 bg-pink-400 rounded-full hover:bg-pink-600"
         href="https://qrkks.github.io/tag/toc.html">toc</a>
      <a class="px-3 py-1 text-white duration-300 bg-pink-400 rounded-full hover:bg-pink-600"
         href="https://qrkks.github.io/tag/nav.html">nav</a>
      <a class="px-3 py-1 text-white duration-300 bg-pink-400 rounded-full hover:bg-pink-600"
         href="https://qrkks.github.io/tag/tailwind.html">tailwind</a>
  </p>
</footer><section id="erectContainer"
         class="px-5 py-10 my-10 border-t border-gray-400 not-prose erect-it font-Arial">
  <div id="twikoo">
  </div>
  <script async
          src="https://cdn.jsdelivr.net/npm/twikoo@1.6.27/dist/twikoo.min.js"></script>
  <script>
    window.onload = function() {
      twikoo.init({
        envId: 'https://39.107.126.13:8092/',
        path: 'drafts/building-dynamic-toc-with-javascript.html'
      });
      tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.js-toc',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.js-toc-content',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1, h2, h3, h4 ,h5',
        // For headings inside relative or absolute positioned containers within content.
      });
    };
  </script>
</section>  </article>
      </main>
    </div>
    <footer class="flex items-center justify-center h-32 text-sm prose text-gray-500 bg-gray-100 max-w-none">
      <address class="not-italic text-center">
        Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>,
        which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
      </address>
    </footer>
  </body>
</html>